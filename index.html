<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All X World</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Orbitron', sans-serif; margin: 0; padding: 0; overflow: hidden; background-color: #0f0f1a; color: #ffffff; }
    .splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at center, #1c1c2b 0%, #0f0f1a 70%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; opacity: 1; transition: opacity 0.8s ease-in-out 0.5s; }
    .splash-screen.hidden { opacity: 0; pointer-events: none; }
    .brand-container { text-align: center; perspective: 800px; z-index: 10; }
    .brand-name span { font-family: 'Orbitron', sans-serif; font-size: clamp(30px, 8vw, 100px); font-weight: 700; color: #00e5ff; text-shadow: 0 0 5px rgba(0, 229, 255, 0.95), 0 0 10px rgba(0, 229, 255, 0.9), 0 0 20px rgba(0, 229, 255, 0.7), 0 0 35px rgba(0, 170, 204, 0.5), 0 0 60px rgba(0, 120, 150, 0.3); opacity: 0; transform: translateY(40px) scale(0.7) rotateX(-60deg); transform-origin: bottom center; display: inline-block; animation: letterReveal 0.7s ease forwards; }
    @keyframes letterReveal { 0% { opacity: 0; transform: translateY(40px) scale(0.7) rotateX(-60deg); } 60% { transform: translateY(-10px) scale(1.05) rotateX(15deg); opacity: 0.8; } 100% { opacity: 1; transform: translateY(0) scale(1) rotateX(0deg); } }
    #particleCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    .content-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transform: scale(0.95); transition: opacity 1s ease, transform 1s ease; z-index: 10; }
    .content-container.active { opacity: 1; transform: scale(1); }
    iframe { width: 100%; height: 100%; border: none; display: block; }
    .message-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at center, #1c1c2b 0%, #0f0f1a 70%); display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; z-index: 100; opacity: 0; visibility: hidden; transition: opacity 0.5s ease, visibility 0.5s ease; }
    .message-container.active { opacity: 1; visibility: visible; }
    .message-icon { font-size: 80px; margin-bottom: 20px; color: #ff3366; text-shadow: 0 0 15px rgba(255, 51, 102, 0.7); }
    .message-title { font-size: clamp(24px, 5vw, 48px); margin-bottom: 20px; color: #ff3366; text-shadow: 0 0 10px rgba(255, 51, 102, 0.7); }
    .message-text { font-size: clamp(16px, 3vw, 20px); margin-bottom: 30px; color: #b0b0ff; max-width: 600px; line-height: 1.6; }
    .retry-button { padding: 12px 30px; background: linear-gradient(45deg, #ff3366, #00e5ff); border: none; border-radius: 30px; color: white; font-family: 'Orbitron', sans-serif; font-size: 18px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 15px rgba(255, 51, 102, 0.5); }
    .retry-button:hover { transform: translateY(-3px); box-shadow: 0 0 20px rgba(255, 51, 102, 0.7); }
    @media (max-width: 768px) { .brand-name span { font-size: clamp(24px, 10vw, 60px); } }
  </style>
</head>
<body>
  <div class="splash-screen" id="splashScreen">
    <canvas id="particleCanvas"></canvas>
    <div class="brand-container">
      <div class="brand-name" aria-label="All X World"></div>
    </div>
  </div>
  <div class="content-container" id="contentContainer"></div>
  <div class="message-container" id="offlineMessage">
    <div class="message-icon">⚠️</div>
    <h1 class="message-title">Offline</h1>
    <p class="message-text">It seems you're not connected to the internet. Please check your connection and try again.</p>
    <button class="retry-button" onclick="checkConnection()">Retry</button>
  </div>
  <div class="message-container" id="errorMessage">
    <div class="message-icon">❌</div>
    <h1 class="message-title">Content Unavailable</h1>
    <p class="message-text">We couldn't load the requested content. It might be temporarily unavailable.</p>
    <button class="retry-button" onclick="retryLoading()">Retry</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCUyRkwfnVlbJx6BG00OmaJ5QQBJUwAkMk",
      authDomain: "loading-panel.firebaseapp.com",
      databaseURL: "https://loading-panel-default-rtdb.firebaseio.com",
      projectId: "loading-panel",
      storageBucket: "loading-panel.firebasestorage.app",
      messagingSenderId: "733543703125",
      appId: "1:733543703125:web:b4643732e3fce3af19eadc",
      measurementId: "G-FZS7RDXQ0Y"
    };
    let firebaseInitialized = false;
    try {
      firebase.initializeApp(firebaseConfig);
      firebaseInitialized = true;
    } catch (error) { console.error("Firebase initialization error:", error); }

    const versionConfig = [
        { time: "2025-06-01T10:10:10", uid: "Coming Soon" },
        { time: "2025-10-03T10:10:10", uid: "Coming Soon" },
        { time: "2026-01-01T10:10:10", uid: "allxgaming_sux-1" },
        { time: "2026-12-01T10:10:10", uid: "allxgaming_sux-2" }
    ].sort((a, b) => new Date(a.time) - new Date(b.time));
    
    function getActiveUID() {
      const now = new Date();
      let activeUID = "default";
      for (const entry of versionConfig) {
        if (new Date(entry.time) <= now) activeUID = entry.uid;
        else break;
      }
      return activeUID;
    }
    function getPathFromUID(uid) {
      if (uid.startsWith('allxgaming_')) return 'allxgaming_hubs/' + uid;
      if (uid.startsWith('hifi_')) return 'hifi_items/' + uid;
      return 'games/' + uid;
    }
    function initParticles() {
      const canvas = document.getElementById('particleCanvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      let particles = [];
      for (let i = 0; i < 100; i++) {
        particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2 + 0.5, speedX: (Math.random() - 0.5) * 0.5, speedY: (Math.random() - 0.5) * 0.5, color: `rgba(0, ${Math.floor(229 + Math.random() * 26)}, 255, ${Math.random() * 0.5 + 0.1})` });
      }
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => { p.x += p.speedX; p.y += p.speedY; if (p.x < 0) p.x = canvas.width; if (p.x > canvas.width) p.x = 0; if (p.y < 0) p.y = canvas.height; if (p.y > canvas.height) p.y = 0; ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fillStyle = p.color; ctx.fill(); });
        requestAnimationFrame(animate);
      }
      animate();
      window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; particles = []; for (let i = 0; i < 100; i++) { particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2 + 0.5, speedX: (Math.random() - 0.5) * 0.5, speedY: (Math.random() - 0.5) * 0.5, color: `rgba(0, ${Math.floor(229 + Math.random() * 26)}, 255, ${Math.random() * 0.5 + 0.1})` }); } });
    }
    function showOfflineMessage() { document.getElementById('offlineMessage').classList.add('active'); }
    function hideOfflineMessage() { document.getElementById('offlineMessage').classList.remove('active'); }
    function showErrorMessage() { document.getElementById('errorMessage').classList.add('active'); }
    function hideErrorMessage() { document.getElementById('errorMessage').classList.remove('active'); }
    function showContent() { document.getElementById('contentContainer').classList.add('active'); }
    function checkConnection() { if (navigator.onLine) { hideOfflineMessage(); loadContent(); } else { showOfflineMessage(); } }
    function retryLoading() { hideErrorMessage(); location.reload(); }
    function loadContent() {
      if (!navigator.onLine) { showOfflineMessage(); return; }
      if (!firebaseInitialized) { showErrorMessage(); return; }
      const activeUID = getActiveUID();
      const dbPath = getPathFromUID(activeUID);
      firebase.database().ref(dbPath).once('value')
        .then(snapshot => {
          const data = snapshot.val();
          if (data && data.content) {
            const contentContainer = document.getElementById('contentContainer');
            contentContainer.innerHTML = '';
            const iframe = document.createElement("iframe");
            iframe.srcdoc = data.content;
            iframe.onload = () => { showContent(); };
            contentContainer.appendChild(iframe);
          } else { showErrorMessage(); }
        })
        .catch(err => { console.error("Firebase Error:", err); showErrorMessage(); });
    }
    document.addEventListener('DOMContentLoaded', () => {
      initParticles();
      const brandText = "All X World";
      const brandNameContainer = document.querySelector('.brand-name');
      brandText.split('').forEach((char, i) => {
        const span = document.createElement('span');
        span.textContent = char === ' ' ? '\u00A0' : char;
        span.style.animationDelay = `${0.20 + i * 0.08}s`;
        brandNameContainer.appendChild(span);
      });
      
      // ✅ =============================================================
      // ✅ রেস কন্ডিশনের চূড়ান্ত সমাধান
      // ✅ =============================================================
      window.addEventListener('message', (event) => {
        const iframe = document.querySelector('#contentContainer iframe');
        // ১. iframe থেকে 'iframe-ready' সিগন্যাল গ্রহণ করা
        if (event.data && event.data.type === 'iframe-ready' && iframe) {
            if (window.location.hash) {
              iframe.contentWindow.postMessage({ type: 'url-hash', hash: window.location.hash }, '*');
            } else {
              iframe.contentWindow.postMessage({ type: 'show-home' }, '*');
            }
        }
        // ২. iframe থেকে আসা 'share' অনুরোধটি পরিচালনা করা
        if (event.data && event.data.type === 'share') {
          const shareData = event.data.data;
          if (navigator.share) {
            navigator.share(shareData).catch(err => console.error('Share failed:', err));
          } else {
            navigator.clipboard.writeText(shareData.url)
              .then(() => alert('Link copied to clipboard!'))
              .catch(err => console.error('Clipboard write failed:', err));
          }
        }
         // ৩. iframe থেকে আসা হ্যাশ পরিবর্তনের অনুরোধ গ্রহণ এবং URL আপডেট করা
        if (event.data && event.data.type === 'set-hash') {
          if (window.location.hash !== event.data.hash) {
             history.pushState(null, '', event.data.hash);
          }
        }
      });
      
      // ৪. ব্রাউজারের Back/Forward বাটন কাজ করানোর জন্য
      window.addEventListener("hashchange", () => {
        const iframe = document.querySelector("#contentContainer iframe");
        if (iframe && iframe.contentWindow) {
          iframe.contentWindow.postMessage({ type: "url-hash", hash: window.location.hash }, "*");
        }
      });
      const animationTime = (brandText.length * 0.08 + 0.20 + 0.7) * 1000;
      const extraDelay = 1200;
      const fadeDelay = animationTime + extraDelay;
      setTimeout(() => {
        document.getElementById('splashScreen').classList.add('hidden');
        setTimeout(() => loadContent(), 800);
      }, fadeDelay);
      window.addEventListener('online', hideOfflineMessage);
      window.addEventListener('offline', showOfflineMessage);
    });
  </script>
</body>
</html>
